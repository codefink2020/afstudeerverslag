
\chapter{Onderzoek: Methode en tooling om analyses te doen op externe bibliotheken binnen EagleScience}\label{ch:onderzoek:-methode-en-tooling-om-analyses-te-doen-op-externe-bibliotheken-binnen-eaglescience}
In het vorige hoofdstukis duidelijk geworden dat er veel externe bibliotheken worden gebruikt om applicaties te ontwikkelen. Veel bedrijven kunnen niet meer zonder en EagleScience is hier geen uitzondering op. Het gebruik van externe bibliotheken heeft te veel voordelen op het gebied van besparing(tijd en geld), flexibiliteit, standaardisering om te proberen om deze voordelen te benutten middels intern ontwikkelde projecten. Het gebruik van externe bibliotheken is echter niet zonder gevaren en zonder dat er maatregelen worden genomen kunnen er kwetsbaarheden worden gebruikt om informatie of functionaliteit binnen een applicatie te misbruiken door kwaadwillenden. Er bestaan bronnen zoals de NVD van het NIST waarin deze kwetsbaarheden worden opgeslagen. Het is echter ondoenlijk om deze database met de hand te doorzoeken. Zeker op het moment dat de applicaties dusdanig veel bibliotheken gebruiken dat het volume te groot wordt. Volgens de aanwijzingen vermelding in de OWASP-top10 dienen alle dependencies en de geneste dependencies gecontrolleert te worden.

Dit onderzoek gaat over het zoeken van tooling en methoden om deze analyse automatisch en periodiek te kunnen doen om zo inzichtelijk te maken of er kwetsbaarheden in de uitgerolde applicatie zitten. Met het gebruiken van deze methode hoeft alleen de applicatie nog maar met de hand up-to-date te worden gehouden. Dit laatste is door de complexiteit bewust uit de opdracht gehouden. De onderzoeksvraag is dan ook: "Welke SCA tooling is compabitble met de omgeving van EagleScience en welke methode kan worden toegepast om deze tooling te gebuiken voor het automatisch analyseren van externe dependencies?". De hoofdvraag werpt de volgende deelvragen op die ieders hieronder worden beantwoord in een eigen paragraaf waarna een in de conclussie de methode wordt aangeboden.
Deelvragen:
\begin{itemize}
    \item Welke Dev-stack gebruikt EagleScience?
    \item Op welke wijze ontwikkeld EagleScience software?
    \item Hoe wordt er op dit moment software uitgerold binnen EagleScience?
    \item Wat zijn de selectiecriteria voor tools die gebruikt kunnen worden?
    \item Welke tools zijn er beschikbaar?
    \item Welke data produceren de tools?
    \item Hoe zijn deze tools te intgreren in de huidige buildstraat van EagleScience?
    \item Welke methode kan worden gebruikt om middels de gevonden tools informatie over kwetsbaarheden binnen externe bibliotheken te vinden?
    \item
\end{itemize}




De eerste inzet om de opdracht tot een goed einde te brengen is het vinden van tooling om analyses te kunnen doen op externe bibliotheken. Voor nu is het zoeken naar een oplossing voor Scala en Typescript(Node.js) voldoende. In eerdere onderzoeken is naar boven gekomen dat de OWASP zich bezig houd met het veilig houden van geschreven software. Een van de projecten die de OWASp is "Dependency-check". Dit is een Software Composition Tool wat mogelijk maakt om openbaar gemaakte kwetsbaarheden te detecteren door te kijken of er voor dependencies een Common Platform Enumeration(CPE) bestaat. Als deze CPE bestaat kan er gekeken worden of er een CVE voor bestaat en vervolgens worden weergegeven in resultaten. Als geen van beiden bekend zijn wordt er door de tool vanuit gegaan dat er op het moment van checken geen kwetsbaarheid gevonden is. Hoewel dit op het oog een goede tool is om SOUP te analyseren is het in het project ontwikkelde versie niet mogelijk om te scannen op SBT en NPM dependencies. Op de website van het project is echter een link naar een versie die SBT projecten kan analyseren. En een search in de NPM repository blijkt dat er een soortgelijke tool bestaat om NPM pakketten te analyseren.


In dit onderzoek worden deze twee tools getest om te achterhalen of deze tools daadwerkelijk geschikt zijn voor de doeleinden van het project. Dit wordt gedaan door de tools te gebruiken in een sandbox project die specifiek voor dit onderzoek is opgezet om de werking van de tool te achterhalen en vervolgens in een groot bestaand project om te kijken of de bevindingen in de sandbox ook te zien zijn in een echte situatie.
De onderzoeksvraag voor dit onderzoek luid dan ook: "Hoe zijn de gevonden tools te integreren in de methode om dependencies te analyseren en zijn de resultaten bruikbaar voor verder gebruik in de module?" Deze hoofdvraag geeft een aantal deelvragen die in de conclussie beantwoord dienen te zijn.
\begin{itemize}
    \item Hoe kan de tool worden gebruikt in huidige projecten?
    \item Komen de resultaten die gepubliseerd worden vanuit de projecten overeen met elkaar, Zijn de structuren vergelijkbaar?
    \item Wat doet de tool op de performance van de huidige Jenkins buildstraat, Hoelang heeft de tool nodig om resulaten te genereren?
    \item Zijn de resulaten voldoende om er daadwerkelijk een raport van te genereren die door de gebruikers gelezen kunnen worden.
    \item Hoeveel kennis van het project hebben de tools nodig om te functioneren? is de dependency declaratie voldoende of is het gehele project nodig voor de analyse.
\end{itemize}


\section{methode}
Om de bovenstaande deelvragen te beantwoorden is er gekozen om in drie situaties te testen. Iedere situatie wordt opgezet voor zowel de SBT(Scala) tools als die voor NPM(TypeScript).
\begin{enumerate}
    \item \textbf{sandbox omgeving} Dit is een omgeving waarbij een standaard project wordt opgezet met alleen de basis logica om het project te kunnen draaien. In het geval van Scala zal dit een playframework project zijn met daarin enkele database dependencies. Voor NPM zal dit een Angular Applicatie zijn met een UI framework.
    \item \textbf{Bestaand EagleScience Project}. Een project wat zowel een SBT-project bevat als een NPM(node.js) Project bevat.
    \item \textbf{ALleen de dependency declaraties} In het geval van SBT is dit dus de build.sbt en voor NPM is dit  een package.json en wellicht ook de package.json.lock.
\end{enumerate}

\section{Sandbox}
Het doel van deze test is om te kijken of de tooling Ã¼berhaubt werkt en dat er bruikbare resultaten komen. De InteliJ wizards zijn gebruikt om een basis project op te zetten waar vervolgens volgens de documentatie de tooling is geimplementeerd.

Het resultaat is:

De gegenereerde JSON files zijn in opmaak identiek dus er kanmakkelijk een plugin geschreven worden die beide files in de database kan zetten
\section{}

https://github.com/etnetera/owasp-dependency-check for Node.js /NPM
https://github.com/albuch/sbt-dependency-check for SBT

https://github.com/eliasgranderubio/dagda niet zelfde als OWASP maar wellicht usefull


Dit hoofdstuk geeft het onderzoek weer naar tools die binnen EagleScience ingezet kunnen worden voor het analyseren van de dependencies. De hoofdvraag in dit onderzoek is dan ook: "Welke tools kunnen er ingezet worden om binnen de dev-stack van EagleScience een analyse te doen op kwetsbaarheden in externe biblotheken?" Om deze vraag te kunnen beantwoorden zijn de volgende deelvragen opgesteld die samen een conclussie opleveren die gebruikt kan worden in het ontwerp van de module.



\section{Conclusie}\label{sec:conclusie}
De twee tools draaien beiden op de zelfde engine. wat er vervolgens voor zorgt dat er voor beide tools nagenoeg de zelfde output is. Echter door de complexiteit van de projecten die uitgerold worden is voor de SBT tool veel werk om alle dependencie te analyseren wat niet te goed komt in de build tijd. op basis van dit gegeven is er voor gekozen om later een analyse uit te voeren op de dependencies en de pipeline alleen de gebruikte dependencies en hun versies te borgen in een snapshot in de database en deze snapshots periodiek te analyseren op kwetsbaarheden. Het voordeel van deze manier is naast dat het minder tijd kost in de build pipeline. we de analyse kunnen uitvoeren op ieder gewenst moment en dus ook in de nachtelijke uren wanneer de servers niet de druk hebben die ze overdag hebben. Voor het ontwerp moet er dan ook een manier gevonden worden om snapshots op te slaan waarin minimaal de volgende attributen zijn vastgelegd:
\begin{itemize}
    \item \textbf{timestamp:} De datum en tijd wanneer de snapshot is gemaakt
    \item \textbf{GitHash:} De Hash van de commit die de build heeft getriggered
    \item \textbf{projectName:} Naam van het project waar de snapshot voor is gemaakt
    \item \textbf{omgeving:} Op welke omgeving werdt er gebuild toen de snapshot is gemaakt
    \item \textbf{projectType:} Is het een SBT of NPM project ( later uit te breiden met een MAVEN en bijv. NUGET)
    \item \textbf{dependencyList:} Lijst van de gevonden dependencies en hun versies
    \item \textbf{analysed:} Boolean om aan te geven of de snapshot al is geannalyseerd.
\end{itemize}

Voorhet maken van de snapshots moeten er in de jenkins pipeline een mechaniek worden geplaatst die de gevonden attributen kan opslaan in een database voor later gebruik.

Een bijkomend voordeel van deze manier van werken is dat er een historiek onstaat in de gebruikte versies welke als bewijsvoering kan dienen bij incidenten.
